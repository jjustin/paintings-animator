<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animate</title>
    <link rel="stylesheet" href="stylesheet.css">

</head>

<body>
    <div id="container">

        <div id="image-picker">
            <div class="row">
                <p id="demo"></p>

                <script>

                    async function getArray() {
                        return await fetch("http://localhost:5000/images").then(response => response.json())
                    }

                    async function myFunction() {
                        var obj = await getArray()
                        console.log(obj)
                        var arr = obj.images

                        for (img of arr) {
                            const image = document.createElement('img')
                            image.src = '/images/' + img
                            image.classList.add("image")
                            img_n = img.split('.')
                            image.id = img_n[0]
                            image.name = img_n[0]

                            document.querySelector('#demo').appendChild(image)
                        }
                    }

                    myFunction()

                    document.querySelectorAll('#demo').forEach(function (el) {
                        el.addEventListener('click', function (e) {
                            console.log(e.target.id)

                            el.style.border = ''

                            if (selected_img != '') {
                                var children = document.getElementById("demo").children
                                for (var i = 0; i < children.length; i++) {
                                    var tableChild = children[i]
                                    // console.log(tableChild)                                    
                                    tableChild.style.border = ''
                                }
                                e.target.style.border = "6px solid grey"
                                selected_img = e.target.id
                                el.style.border = ''
                            }
                            else {
                                e.target.style.border = "6px solid grey"
                                selected_img = e.target.id
                                el.style.border = ''
                                // console.log(selected_img)
                            }
                            console.log(selected_img)
                            changeVideo()
                        })
                    })
                </script>
            </div>
        </div>

        <div id="video-picker">
            <video class="izvorni_videi" controls muted>
                <source src="izvorni_videi/video1.mp4" type="video/mp4">
            </video>
            <video class="izvorni_videi" controls muted>
                <source src="izvorni_videi/video2.mp4" type="video/mp4">
            </video>

            <!-- not done - change ids as the name of the corresponding video -->
            <input type="image" src="emoji/angry.png" name="angry" class="image2" id="angry" onclick="border(this)">
            <input type="image" src="emoji/sad.png" name="sad" class="image2" id="sad" onclick="border(this)">
            <input type="image" src="emoji/smile.png" name="smile" class="image2" id="input4" onclick="border(this)">

            <script>
                var selected_img = ''
                var selected_emoji = ''

                function changeVideo() {
                    console.log(selected_emoji, selected_img)
                    if (selected_emoji != '' && selected_img != '') {
                        var output = document.getElementById("video")
                        var source = document.getElementById("source")

                        output.pause()
                        source.src = "output/output_" + selected_emoji + "_" + selected_img + ".mp4"
                        output.load()
                        output.play()

                        console.log(output)
                    }
                }

                function border(el) {
                    var els = document.getElementsByClassName("image2")

                    if (selected_emoji != '') {

                        for (var i = 0; i < els.length; i++) {
                            var tableChild = els[i]
                            tableChild.style.border = ''
                        }
                        el.style.border = "6px solid grey"
                        selected_emoji = el.id
                    }
                    else {
                        el.style.border = "6px solid grey"
                        selected_emoji = el.id
                        console.log(selected_emoji)
                    }
                    changeVideo()
                }

            </script>
        </div>

        <div id="result">
            <video class="result-video" autoplay="autoplay" id="video" muted loop> >
                <source id="source" src="output/video1.mp4" type="video/mp4">
            </video>
        </div>
    </div>
</body>

</html>
